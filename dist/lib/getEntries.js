var e=PPx.CreateObject("Scripting.FileSystemObject"),validArgs=function(){for(var e=[],r=PPx.Arguments;!r.atEnd();r.moveNext())e.push(r.value);return e},safeArgs=function(){for(var e=[],r=validArgs(),t=0,n=arguments.length;t<n;t++)e.push(_valueConverter(t<0||arguments.length<=t?undefined:arguments[t],r[t]));return e},_valueConverter=function(e,r){if(null==r||""===r)return null!=e?e:undefined;switch(typeof e){case"number":var t=Number(r);return isNaN(t)?e:t;case"boolean":return null!=r&&"false"!==r&&"0"!==r;default:return r}},pathSelf=function(){var e,r,t=PPx.ScriptName;return~t.indexOf("\\")?(e=extractFileName(t),r=PPx.Extract("%*name(DKN,"+t+")")):(e=t,r=PPx.Extract("%FDN")),{scriptName:e,parentDir:r.replace(/\\$/,"")}},extractFileName=function(e,r){return void 0===r&&(r="\\"),"\\"!==r&&"/"!==r&&(r="\\"),e.slice(e.lastIndexOf(r)+1)},main=function(){var e=safeArgs(PPx.Extract("%FD"),"both","",0),r=e[0],t=e[1],n=e[2],a=e[3],u=t.toLowerCase();if(!isSearchSpec(u)){var i=pathSelf(),o=i.scriptName,f=i.parentDir;PPx.Execute('*script "'+f+'\\errors.js",arg,'+o),PPx.Quit(-1)}return getEntries(r,u,n.toLowerCase(),a).join(",")},isSearchSpec=function(e){return"both"===e||"file"===e||"dir"===e},getEntries=function(r,t,n,a){var extractEntries=function(r,t){for(var i=PPx.Enumerator(r);!i.atEnd();i.moveNext()){if(a>0&&u.length>=a)return;~i.Item().Name.toLowerCase().indexOf(n)&&u.push(e.BuildPath(t,i.Item().Name))}},_detectItem=function(n){void 0===n&&(n="");var i=e.GetFolder(e.BuildPath(r,n)),o=i.SubFolders;if("file"!==t&&extractEntries(o,n),"dir"!==t&&extractEntries(i.Files,n),a>0){if(u.length>=a)return;for(var f=0;f<o.length;f++){var l=o[f];_detectItem(e.BuildPath(n,l.Name))}}},u=[];return _detectItem(),u};PPx.result=main();
