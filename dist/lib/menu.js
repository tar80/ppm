var e,r,t,n;Object.keys||(Object.keys=(e=Object.prototype.hasOwnProperty,r=!{toString:null}.propertyIsEnumerable("toString"),n=(t=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(i){if("function"!=typeof i&&("object"!=typeof i||null==i))throw new Error("Object.keys: called on non-object");var o,a,u=[];for(o in i)e.call(i,o)&&u.push(o);if(r)for(a=0;a<n;a++)e.call(i,t[a])&&u.push(t[a]);return u}));var validArgs=function(){for(var e=[],r=PPx.Arguments;!r.atEnd();r.moveNext())e.push(r.value);return e},safeArgs=function(){for(var e=[],r=validArgs(),t=0,n=arguments.length;t<n;t++)e.push(_valueConverter(t<0||arguments.length<=t?undefined:arguments[t],r[t]));return e},_valueConverter=function(e,r){if(null==r||""===r)return null!=e?e:undefined;switch(typeof e){case"number":var t=Number(r);return isNaN(t)?e:t;case"boolean":return null!=r&&"false"!==r&&"0"!==r;default:return r}},i={ppmName:"ppx-plugin-manager",ppmVersion:.95,language:"ja",encode:"utf16le",nlcode:"\r\n",nltype:"crlf",ppmID:"P",ppmSubID:"Q"},o={actions:"S_ppm#actions",event:"S_ppm#event",global:"S_ppm#global",sources:"S_ppm#sources",staymode:"S_ppm#staymode",user:"S_ppm#user"},useLanguage=function(){var e=PPx.Extract("%*getcust("+o.global+":lang)");return"en"===e||"ja"===e?e:i.language},isEmptyObj=function(e){if(e===undefined)return!1;if(null===e)return!0;for(var r in e)return!1;return!0},a=PPx.CreateObject("Scripting.FileSystemObject"),u={TypeToCode:{crlf:"\r\n",cr:"\r",lf:"\n"},CodeToType:{"\r\n":"crlf","\r":"cr","\n":"lf"},Ppx:{lf:"%%bl",cr:"%%br",crlf:"%%bn",unix:"%%bl",mac:"%%br",dos:"%%bn","\n":"%%bl","\r":"%%br","\r\n":"%%bn"},Ascii:{lf:"10",cr:"13",crlf:"-1",unix:"10",mac:"13",dos:"-1","\n":"10","\r":"13","\r\n":"-1"}},isCV8=function(){return"ClearScriptV8"===PPx.ScriptEngineName},_exec=function(e,r){try{var t;return[!1,null!=(t=r())?t:""]}catch(n){return[!0,""]}finally{e.Close()}},writeLines=function(e){var r=e.path,t=e.data,n=e.enc,o=void 0===n?"utf8":n,l=e.append,s=void 0!==l&&l,c=e.overwrite,p=void 0!==c&&c,f=e.linefeed,P=void 0===f?i.nlcode:f;if(!p&&!s&&a.FileExists(r))return[!0,r+" already exists"];var x,d=a.GetParentFolderName(r);if(a.FolderExists(d)||PPx.Execute("*makedir "+d),"utf8"===o){if(isCV8()){var m=t.join(P),v=s?"AppendAllText":"WriteAllText";return[!1,NETAPI.System.IO.File[v](r,m)]}var b=p||s?2:1,h=PPx.CreateObject("ADODB.Stream");x=_exec(h,(function(){h.Open(),h.Charset="UTF-8",h.LineSeparator=Number(u.Ascii[P]),s?(h.LoadFromFile(r),h.Position=h.Size,h.SetEOS):h.Position=0,h.WriteText(t.join(P),1),h.SaveToFile(r,b)}))[0]}else{var g=s?8:p?2:1;a.FileExists(r)||PPx.Execute("%Osq *makefile "+r);var y="utf16le"===o?-1:0,S=a.GetFile(r).OpenAsTextStream(g,y);x=_exec(S,(function(){S.Write(t.join(P)+P)}))[0]}return x?[!0,"Could not write to "+r]:[!1,""]},pathSelf=function(){var e,r,t=PPx.ScriptName;return~t.indexOf("\\")?(e=extractFileName(t),r=PPx.Extract("%*name(DKN,"+t+")")):(e=t,r=PPx.Extract("%FDN")),{scriptName:e,parentDir:r.replace(/\\$/,"")}},extractFileName=function(e,r){return void 0===r&&(r="\\"),"\\"!==r&&"/"!==r&&(r="\\"),e.slice(e.lastIndexOf(r)+1)},properties=function(e){for(var r=PPx.Extract("%*getcust("+e+")").split(i.nlcode),t={},n=/^([^,=]+)([,=])\s*(.*)/,o="",a=1,u=r.length-2;a<u;a++){""!==r[a].replace(n,(function(e,r,n,i){return o=r.replace(/[\s\uFEFF\xA0]+$/,""),t[o]={sep:n,value:[i]},""}))&&t[o].value.push(r[a].replace(/^\s*/,""))}return t},main=function(){var e=safeArgs("insert","",-1,undefined,""),r=e[0],t=e[1],n=e[2],i=e[3],o=e[4];if(null==i){var a=pathSelf(),u=a.scriptName,c=a.parentDir;PPx.Execute('*script "'+c+'\\errors.js",args,'+u),PPx.Quit(1)}var p=properties(t);if(isEmptyObj(p))return l.noProps;if(null!=p[i]){if("insert"===r)return l.hasProp}else if("insert"!==r)return t+" "+l.notHasProp;var f=rebuildMenu(t,p),P=Math.max(1,n<0?f.length+n:Math.floor(n)),x=i+"\t= "+o,d=s[r](f,P,x),m=PPx.Extract("%'temp'%\\ppm")+"\\_menu.cfg",v=writeLines({path:m,data:d,overwrite:!0}),b=v[0],h=v[1];return b?h:(PPx.Execute("*setcust @"+m),l.finish)},l={en:{noProps:"No property",hasProp:"Property already exists",notHasProp:"is missing",finish:"Menu has been regenerated. Please restart PPx"},ja:{noProps:"項目がありません",hasProp:"すでに項目があります",notHasProp:"はありません",finish:"メニューを再生成しました。PPxを再起動してください"}}[useLanguage()],rebuildMenu=function(e,r){for(var t=["-|"+e+" ="+i.nlcode+e+"\t= {"],n=0,o=Object.keys(r);n<o.length;n++){var a=o[n];t.push(a+"\t"+r[a].sep+" "+r[a].value.join(i.nlcode))}return t.push("}"),t},s={insert:function(e,r,t){return e.splice(r,0,t),e},replace:function(e,r,t){return e.splice(r,1,t),e},"delete":function(e,r,t){return e.splice(r-1,1),e}};PPx.result=main();
