var e,r,t,n;Object.keys||(Object.keys=(e=Object.prototype.hasOwnProperty,r=!{toString:null}.propertyIsEnumerable("toString"),n=(t=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(i){if("function"!=typeof i&&("object"!=typeof i||null==i))throw new TypeError("Object.keys: called on non-object");var o,a,u=[];for(o in i)e.call(i,o)&&u.push(o);if(r)for(a=0;a<n;a++)e.call(i,t[a])&&u.push(t[a]);return u}));var i="jp",o="\r\n",a=function(e){return""===e},u={TypeToCode:{crlf:"\r\n",cr:"\r",lf:"\n"},CodeToType:{"\r\n":"crlf","\r":"cr","\n":"lf"},Ppx:{lf:"%%bl",cr:"%%br",crlf:"%%bn",unix:"%%bl",mac:"%%br",dos:"%%bn","\n":"%%bl","\r":"%%br","\r\n":"%%bn"},Ascii:{lf:"10",cr:"13",crlf:"-1",unix:"10",mac:"13",dos:"-1","\n":"10","\r":"13","\r\n":"-1"}},s=PPx.CreateObject("Scripting.FileSystemObject"),l=function(e,r){try{var t;return[!1,null!=(t=r())?t:""]}catch(n){return[!0,""]}finally{e.Close()}},c=function(e){var r=e.path,t=e.data,n=e.enc,i=void 0===n?"utf8":n,a=e.append,c=void 0!==a&&a,p=e.overwrite,f=void 0!==p&&p,P=e.linefeed,x=void 0===P?o:P;if(!f&&!c&&s.FileExists(r))return[!0,r+" already exists"];var d,m=s.GetParentFolderName(r);if(s.FolderExists(m)||PPx.Execute("*makedir "+m),"utf8"===i){if("ClearScriptV8"===PPx.ScriptEngineName){var v=t.join(x),b=c?"AppendAllText":"WriteAllText";return[!1,NETAPI.System.IO.File[b](r,v)]}var h=f||c?2:1,y=PPx.CreateObject("ADODB.Stream");d=l(y,(function(){y.Open(),y.Charset="UTF-8",y.LineSeparator=Number(u.Ascii[x]),c?(y.LoadFromFile(r),y.Position=y.Size,y.SetEOS):y.Position=0,y.WriteText(t.join(x),1),y.SaveToFile(r,h)}))[0]}else{var E=c?8:f?2:1;s.FileExists(r)||PPx.Execute("%Osq *makefile "+r);var g="utf16le"===i?-1:0,O=s.GetFile(r).OpenAsTextStream(E,g);d=l(O,(function(){O.Write(t.join(x)+x)}))[0]}return d?[!0,"Could not write to "+r]:[!1,""]},p=function(){var e,r,t=PPx.ScriptName;return~t.indexOf("\\")?(e=t.replace(/^.*\\/,""),r=PPx.Extract("%*name(DKN,"+t+")")):(e=t,r=PPx.Extract("%FDN")),{scriptName:e,parentDir:r.replace(/\\$/,"")}}(),f=p.scriptName,P=p.parentDir,x={en:{noProps:"No property",hasProp:"Property already exists",notHasProp:"is missing",finish:"Menu has been regenerated. Please restart PPx"},jp:{noProps:"項目がありません",hasProp:"すでに項目があります",notHasProp:"はありません",finish:"メニューを再生成しました。PPxを再起動してください"}}[function(){var e=PPx.Extract("%*getcust(S_ppm#global:lang)");return"en"===e||"jp"===e?e:i}()],d=function(e){void 0===e&&(e=PPx.Arguments);for(var r=["insert","-1","",""],t=0,n=e.length;t<n;t++)r[t]=e.Item(t);return{order:r[0],id:r[1],num:Math.floor(Number(r[2])),subid:r[3],value:r[4]}},m=function(e,r){for(var t=["-|"+e.id+" ="+o+e.id+"\t= {"],n=0,i=Object.keys(r);n<i.length;n++){var a=i[n];t.push(a+"\t"+r[a].sep+" "+r[a].value.join(o))}return t.push("}"),t},v={insert:function(e,r,t){return e.splice(r,0,t),e},replace:function(e,r,t){return e.splice(r,1,t),e},"delete":function(e,r,t){return e.splice(r-1,1),e}};PPx.result=function(){var e=d();(a(e.subid)||a(e.value))&&(PPx.Execute('*script "'+P+'\\errors.js",args,'+f),PPx.Quit(1));var r=function(e){for(var r=PPx.Extract("%*getcust("+e+")").split(o),t={},n=/^([^,=]+)([,=])\s*(.*)/,i="",a=1,u=r.length-2;a<u;a++)""!==r[a].replace(n,(function(e,r,n,o){return i=r.replace(/[\s\uFEFF\xA0]+$/,""),t[i]={sep:n,value:[o]},""}))&&t[i].value.push(r[a].replace(/^\s*/,""));return t}(e.id);if(function(e){if(e===undefined)return!1;if(null===e)return!0;for(var r in e)return!1;return!0}(r))return x.noProps;if(null!=r[e.subid]){if("insert"===e.order)return x.hasProp}else if("insert"!==e.order)return e.id+" "+x.notHasProp;var t,n=m(e,r),i=Math.max(1,e.num<0?n.length+e.num:e.num),u=e.subid+"\t= "+e.value,s=v[e.order](n,i,u),l=(t=PPx.Extract('%*extract(C,"%%*temp()")'),{dir:t,file:t+"_ppmtemp",lf:t+"_temp.xlf",stdout:t+"_stdout",stderr:t+"_stderr",ppmDir:function(){var e=PPx.Extract("%'temp'%\\ppm");return PPx.Execute("*makedir "+e),e}}).file,p=c({path:l,data:s,overwrite:!0}),b=p[0],h=p[1];return b?h:(PPx.Execute("*setcust @"+l),x.finish)}();
