var r,e,t,n;Object.keys||(Object.keys=(r=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),n=(t=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(i){if("function"!=typeof i&&("object"!=typeof i||null==i))throw new TypeError("Object.keys: called on non-object");var o,a,u=[];for(o in i)r.call(i,o)&&u.push(o);if(e)for(a=0;a<n;a++)r.call(i,t[a])&&u.push(t[a]);return u}));var i="jp",o="\r\n",a=function(r){return""===r},u=PPx.CreateObject("Scripting.FileSystemObject"),s={TypeToCode:{crlf:"\r\n",cr:"\r",lf:"\n"},CodeToType:{"\r\n":"crlf","\r":"cr","\n":"lf"},Ppx:{lf:"%%bl",cr:"%%br",crlf:"%%bn",unix:"%%bl",mac:"%%br",dos:"%%bn","\n":"%%bl","\r":"%%br","\r\n":"%%bn"},Ascii:{lf:"10",cr:"13",crlf:"-1",unix:"10",mac:"13",dos:"-1","\n":"10","\r":"13","\r\n":"-1"}},l=function(r,e){try{var t;return[!1,null!=(t=e())?t:""]}catch(n){return[!0,""]}finally{r.Close()}},c=function(r){var e=r.path,t=r.data,n=r.enc,i=void 0===n?"utf8":n,a=r.append,c=void 0!==a&&a,p=r.overwrite,f=void 0!==p&&p,P=r.linefeed,d=void 0===P?o:P;if(!f&&!c&&u.FileExists(e))return[!0,e+" already exists"];var x,v=u.GetParentFolderName(e);if(u.FolderExists(v)||PPx.Execute("*makedir "+v),"utf8"===i){if("ClearScriptV8"===PPx.ScriptEngineName){var m=t.join(d),b=c?"AppendAllText":"WriteAllText";return[!1,NETAPI.System.IO.File[b](e,m)]}var h=f||c?2:1,y=PPx.CreateObject("ADODB.Stream");x=l(y,(function(){y.Open(),y.Charset="UTF-8",y.LineSeparator=Number(s.Ascii[d]),c?(y.LoadFromFile(e),y.Position=y.Size,y.SetEOS):y.Position=0,y.WriteText(t.join(d),1),y.SaveToFile(e,h)}))[0]}else{var g=c?8:f?2:1,E="utf16le"===i?-1:0,j=u.GetFile(e).OpenAsTextStream(g,E);x=l(j,(function(){j.Write(t.join(d)+d)}))[0]}return x?[!0,"Could not write to "+e]:[!1,""]},p=function(){var r,e,t=PPx.ScriptName;return~t.indexOf("\\")?(r=t.replace(/^.*\\/,""),e=PPx.Extract("%*name(DKN,"+t+")")):(r=t,e=PPx.Extract("%FDN")),{scriptName:r,parentDir:e.replace(/\\$/,"")}}(),f=p.scriptName,P=p.parentDir,d={en:{noProps:"No property",hasProp:"Property already exists",notHasProp:"is missing",finish:"Menu has been regenerated. Please restart PPx"},jp:{noProps:"項目がありません",hasProp:"すでに項目があります",notHasProp:"はありません",finish:"メニューを再生成しました。PPxを再起動してください"}}[function(){var r=PPx.Extract("%*getcust(S_ppm#global:lang)");return"en"===r||"jp"===r?r:i}()],x=function(r){void 0===r&&(r=PPx.Arguments);for(var e=["insert","-1","",""],t=0,n=r.length;t<n;t++)e[t]=r.Item(t);return{order:e[0],id:e[1],num:Math.floor(Number(e[2])),subid:e[3],value:e[4]}},v=function(r,e){for(var t=["-|"+r.id+" ="+o+r.id+"\t= {"],n=0,i=Object.keys(e);n<i.length;n++){var a=i[n];t.push(a+"\t"+e[a].sep+" "+e[a].value.join(o))}return t.push("}"),t},m={insert:function(r,e,t){return r.splice(e,0,t),r},replace:function(r,e,t){return r.splice(e,1,t),r},"delete":function(r,e,t){return r.splice(e-1,1),r}};PPx.result=function(){var r=x();(a(r.subid)||a(r.value))&&(PPx.Execute('*script "'+P+'\\errors.js",args,'+f),PPx.Quit(1));var e=function(r){for(var e=PPx.Extract("%*getcust("+r+")").split(o),t={},n=/^([^,=]+)([,=])\s*(.*)/,i="",a=1,u=e.length-2;a<u;a++)""!==e[a].replace(n,(function(r,e,n,o){return i=e.replace(/[\s\uFEFF\xA0]+$/,""),t[i]={sep:n,value:[o]},""}))&&t[i].value.push(e[a].replace(/^\s*/,""));return t}(r.id);if(function(r){if(r===undefined)return!1;if(null===r)return!0;for(var e in r)return!1;return!0}(e))return d.noProps;if(null!=e[r.subid]){if("insert"===r.order)return d.hasProp}else if("insert"!==r.order)return r.id+" "+d.notHasProp;var t,n=v(r,e),i=Math.max(1,r.num<0?n.length+r.num:r.num),u=r.subid+"\t= "+r.value,s=m[r.order](n,i,u),l=(t=PPx.Extract('%*extract(C,"%%*temp()")'),{dir:t,file:t+"_ppmtemp",stdout:t+"_stdout",stderr:t+"_stderr",ppmDir:function(){var r=PPx.Extract("%'temp'%\\ppm");return PPx.Execute("*makedir "+r),r}}).file,p=c({path:l,data:s,overwrite:!0}),b=p[0],h=p[1];return b?h:(PPx.Execute("*setcust @"+l),d.finish)}();
