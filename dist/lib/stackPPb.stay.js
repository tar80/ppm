var t,e,n,i;Object.keys||(Object.keys=(t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),i=(n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(r){if("function"!=typeof r&&("object"!=typeof r||null==r))throw new Error("Object.keys: called on non-object");var c,p,a=[];for(c in r)t.call(r,c)&&a.push(c);if(e)for(p=0;p<i;p++)t.call(r,n[p])&&a.push(n[p]);return a}));var r,validArgs=function(){for(var t=[],e=PPx.Arguments;!e.atEnd();e.moveNext())t.push(e.value);return t},isEmptyStr=function(t){return""===t},isZero=function(t){return null!=t&&("0"===t||0===t)},c="S_ppm#event",p={set:function(t,e){PPx.Execute("*setcust "+c+":"+t+"=%("+e+"%)")},unset:function(t){var e=PPx.Extract("%*getcust("+c+":"+t+")");!isEmptyStr(e)&&PPx.Execute("*deletecust "+c+":"+t)},"do":function(t){var e=PPx.Extract("%*getcust("+c+":"+t+")");!isEmptyStr(e)&&PPx.Execute(e)},once:function(t){var e=PPx.Extract("%*getcust("+c+":"+t+")");isEmptyStr(e)||(PPx.Execute(e),PPx.Execute("*deletecust "+c+":"+t))}},pathSelf=function(){var t,e,n=PPx.ScriptName;return~n.indexOf("\\")?(t=extractFileName(n),e=PPx.Extract("%*name(DKN,"+n+")")):(t=n,e=PPx.Extract("%FDN")),{scriptName:t,parentDir:e.replace(/\\$/,"")}},extractFileName=function(t,e){return void 0===e&&(e="\\"),"\\"!==e&&"/"!==e&&(e="\\"),t.slice(t.lastIndexOf(e)+1)},a={storeData:8e4,veHandler:80001,setsel:80002,stackPPb:80003}.stackPPb,o="ppm_stackppb",u="DoneStackPPb",s={J:0,K:1,L:2,M:3,N:4},P=400,x=10,d=10,b=50,l="SE",f={STANDBY:"READY",INITIAL:"STARTING",ACTIVE:"ACTIVATE",BREAK:"BREAKING"},E={dispWidth:Number(PPx.Extract("%*getcust(S_ppm#global:disp_width)")),dispHeight:Number(PPx.Extract("%*getcust(S_ppm#global:disp_height)"))-b,ppbWidth:P,ppbHeight:0,ppbState:{J:f.STANDBY,K:f.STANDBY,L:f.STANDBY,M:f.STANDBY,N:f.STANDBY},enableIds:Object.keys(s),instances:0,ppcid:PPx.Extract("%n")};if(isZero(E.dispWidth)||isZero(E.dispHeight)){var h=pathSelf().scriptName;PPx.Echo("[ERROR] "+h+" S_ppm#global:disp_width & disp_height needs to be set."),PPx.Quit(-1)}var main=function(){var t=validArgs(),e=t[0],n=t[1],i=t[2];E.ppbWidth=setPPbWidth(e),E.ppbHeight=Math.floor(E.dispHeight/5),E.direction=getDirection(n),PPx.StayMode=a,PPx.Execute("*linecust "+o+",KC_main:LOADEVENT,*execute "+E.ppcid+',*js ":'+a+',ppx_Discard"'),PPx.Execute('%K"@LOADCUST"'),ppx_resume(e,n,i)},ppx_resume=function(t,e,n){if(PPx.Execute("*wait 0,2"),E.instances++,null!=t){if(!(E.instances>=d))for(;;){for(var i=0,c=E.enableIds;i<c.length;i++){var p=c[i],a=isEmptyStr(PPx.Extract("%NB"+p)),o=E.ppbState[p];if(a&&o!==f.INITIAL)return E.ppbState[p]=f.INITIAL,void stackPPb(E.ppcid,p,E.direction,n)}var u=1e3+Math.floor(100*Math.random());if(PPx.Execute("*wait "+u+",2"),r===f.BREAK){E.instances--;break}}}else r=f.BREAK},ppx_Activate=function(t){E.ppbState[t]=f.ACTIVE},ppx_Success=function(t){E.ppbState[t]=f.STANDBY,E.instances--,PPx.Execute("*closeppx B"+t),ppx_Discard()},ppx_Discard=function(){if(E.instances>=0)for(var t=PPx.Extract("%*ppxlist(-B)"),e=0,n=E.enableIds;e<n.length;e++){var i=n[e];if(~t.indexOf("B_"+i))return}for(var r=0,c=E.enableIds;r<c.length;r++){var a=c[r];PPx.Execute("*deletecust _WinPos:B"+a)}p.once(u),PPx.Execute("*linecust "+o+",KC_main:LOADEVENT,"),PPx.StayMode=0},setPPbWidth=function(t){var e=Number(t);return Number.isNaN(e)?P:e},getDirection=function(t){return/^(NW|NE|SW|SE)$/i.test(t)?t.toUpperCase():l},N={NW:function(t){return[0,E.ppbHeight*t]},NE:function(t){return[E.dispWidth-E.ppbWidth-x,E.ppbHeight*t]},SW:function(t){return[0,E.ppbHeight*(4-t)]},SE:function(t){return[E.dispWidth-E.ppbWidth-x,E.ppbHeight*(4-t)]}},stackPPb=function(t,e,n,i){var r=s[e],c=N[n](r),p="-breakjob -noppb -noactive -nostartmsg -wait:no",o="-bootid:"+e+" -q",u="*windowsize %N,"+E.ppbWidth+","+E.ppbHeight,P="*execute "+t+',*js ":'+a+',ppx_Activate",'+e,x='echo "%('+i+'%)"',d="*execute "+t+',*js ":'+a+',ppx_Success",'+e;PPx.Execute("*setcust _WinPos:B"+e+"="+c.join(",")+","+E.ppbWidth+","+E.ppbHeight+",0"),PPx.Execute("*maxlength 3000%:%OP *run "+p+" %0ppbw.exe "+o+" -k %("+u+"%:"+P+"%:"+x+"%:"+i+"%:"+d+"%)")};PPx.result="DONE:"+u,main();
