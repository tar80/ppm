var t,e,n,i;Object.keys||(Object.keys=(t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),i=(n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(r){if("function"!=typeof r&&("object"!=typeof r||null==r))throw new Error("Object.keys: called on non-object");var a,c,o=[];for(a in r)t.call(r,a)&&o.push(a);if(e)for(c=0;c<i;c++)t.call(r,n[c])&&o.push(n[c]);return o}));var validArgs=function(){for(var t=[],e=PPx.Arguments;!e.atEnd();e.moveNext())t.push(e.value);return t},r={storeData:8e4,veHandler:80001,setsel:80002,stackPPb:80003},isEmptyStr=function(t){return""===t},isZero=function(t){return null!=t&&("0"===t||0===t)},a="S_ppm#event",c={set:function(t,e){PPx.Execute("*setcust "+a+":"+t+"=%("+e+"%)")},unset:function(t){var e=PPx.Extract("%*getcust("+a+":"+t+")");!isEmptyStr(e)&&PPx.Execute("*deletecust "+a+":"+t)},"do":function(t){var e=PPx.Extract("%*getcust("+a+":"+t+")");!isEmptyStr(e)&&PPx.Execute(e)},once:function(t){var e=PPx.Extract("%*getcust("+a+":"+t+")");isEmptyStr(e)||(PPx.Execute(e),PPx.Execute("*deletecust "+a+":"+t))}},pathSelf=function(){var t,e,n=PPx.ScriptName;return~n.indexOf("\\")?(t=extractFileName(n),e=PPx.Extract("%*name(DKN,"+n+")")):(t=n,e=PPx.Extract("%FDN")),{scriptName:t,parentDir:e.replace(/\\$/,"")}},extractFileName=function(t,e){return void 0===e&&(e="\\"),"\\"!==e&&"/"!==e&&(e="\\"),t.slice(t.lastIndexOf(e)+1)};Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){var n;if(null==this)throw new Error('Array.indexOf: "this" is null or not defined');var i=Object(this),r=i.length>>>0;if(0===r)return-1;var a=null!=e?e:0;if(Math.abs(a)===Infinity&&(a=0),a>=r)return-1;for(n=Math.max(a>=0?a:r-Math.abs(a),0);n<r;){if(n in i&&i[n]===t)return n;n++}return-1});var o,ppx_Discard$1=function(t,e){var n;PPx.StayMode=0,e=null!=(n=e)?n:"","DEBUG"===t&&PPx.linemessage("[DEBUG] discard "+e)},u=["KC_main","KV_main","KV_img","KV_crt","KV_page","KB_edit","K_ppe","K_edit","K_lied"],_validTable=function(t){return~u.indexOf(t)?t:"KC_main"},_linecust=function(t,e,n){return"*linecust "+t+","+e+":"+n+","},_discard=function(t){return function(e){var n=e.table,i=e.label,r=e.mapkey,a=e.cond,c=void 0===a?"instantly":a,o=e.debug,u=void 0===o?"0":o,p=PPx.StayMode,s=PPx.Extract("%n"),P=PPx.Extract('%*name(C,"%FDV")'),x=_validTable(n),f=_linecust(""+i+s,x,t),d=_linecust(""+i+s,x,"CLOSEEVENT"),l={instantly:"",once:'*if("'+s+'"=="%n")%:',hold:'*if("'+s+'"=="%n")&&("'+P+'"!="%*name(C,"%FDV")")%:'},E=[f,d];r&&(PPx.Execute("*mapkey use,"+r),E.push("*mapkey delete,"+r)),E.push('*js ":'+p+',ppx_Discard",'+u+","+i),PPx.Execute(f+"%(*if %*stayinfo("+p+")%:"+l[c]+E.join("%:")+"%)"),PPx.Execute(d+"%("+l.once+d+"%:"+f+"%)"),PPx.Execute('*run -breakjob -nostartmsg -wait:no %0pptrayw.exe -c %%K"@LOADCUST"')}},getStaymodeId=function(t){t=~t.indexOf(".")?t.slice(0,t.indexOf(".")):t;var e=Number(PPx.Extract("%*getcust(S_ppm#staymode:"+t+")"));return!isNaN(e)&&e>1e4&&e},p=(_discard("ACTIVEEVENT"),_discard("LOADEVENT"),function(t,e,n,i,r){var a="*linecust "+n+","+_validTable(t),c=a+":"+e+",",o={instantly:"",once:'*if("%n"=="%%n")',hold:'*if("%n"=="%%n")&&("%FDV"=="%%FDV")'}[r];PPx.Execute(a+":"+e+","+o+"%%:"+c+"%%:"+i),PPx.Execute('%K"@LOADCUST"')}),s=getStaymodeId("stachPPb")||r.stackPPb,P="ppm_stackppb",x="DoneStackPPb",f={J:0,K:1,L:2,M:3,N:4},d=400,l=10,E=10,b=50,h="SE",g={STANDBY:"READY",INITIAL:"STARTING",ACTIVE:"ACTIVATE",BREAK:"BREAKING"},cache={dispWidth:Number(PPx.Extract("%*getcust(S_ppm#global:disp_width)")),dispHeight:Number(PPx.Extract("%*getcust(S_ppm#global:disp_height)"))-b,ppbWidth:d,ppbHeight:0,ppbState:{J:g.STANDBY,K:g.STANDBY,L:g.STANDBY,M:g.STANDBY,N:g.STANDBY},enableIds:Object.keys(f),instances:0,ppcid:PPx.Extract("%n")};if(isZero(cache.dispWidth)||isZero(cache.dispHeight)){var N=pathSelf().scriptName;PPx.Echo("[ERROR] "+N+" S_ppm#global:disp_width & disp_height needs to be set."),PPx.Quit(-1)}var main=function(){var t=validArgs(),e=t[0],n=t[1],i=t[2];cache.ppbWidth=setPPbWidth(e),cache.ppbHeight=Math.floor(cache.dispHeight/5),cache.direction=getDirection(n),PPx.StayMode=s,PPx.Execute("*linecust "+P+",KC_main:LOADEVENT,*execute "+cache.ppcid+",%(*if 0%%*stayinfo("+s+')%%:*js ":'+s+',ppx_Discard"%)'),PPx.Execute('%K"@LOADCUST"'),ppx_resume(e,n,i)},ppx_resume=function(t,e,n){if(PPx.Execute("*wait 0,2"),cache.instances++,null!=t){if(!(cache.instances>=E))for(;;){for(var i=0,r=cache.enableIds;i<r.length;i++){var a=r[i],c=isEmptyStr(PPx.Extract("%NB"+a)),u=cache.ppbState[a];if(c&&u!==g.INITIAL)return cache.ppbState[a]=g.INITIAL,void stackPPb(cache.ppcid,a,cache.direction,n)}var p=1e3+Math.floor(100*Math.random());if(PPx.Execute("*wait "+p+",2"),o===g.BREAK){cache.instances--;break}}}else o=g.BREAK},ppx_Activate=function(t){cache.ppbState[t]=g.ACTIVE},ppx_Success=function(t){cache.ppbState[t]=g.STANDBY,cache.instances--,PPx.Execute("*closeppx B"+t),ppx_Discard()},ppx_Discard=function(){if(cache.instances>=0)for(var t=PPx.Extract("%*ppxlist(-B)"),e=0,n=cache.enableIds;e<n.length;e++){var i=n[e];if(~t.indexOf("B_"+i))return}for(var r=0,a=cache.enableIds;r<a.length;r++){var o=a[r];PPx.Execute("*deletecust _WinPos:B"+o)}c.once(x),PPx.Execute("*linecust "+P+",KC_main:LOADEVENT,"),PPx.StayMode=0},setPPbWidth=function(t){var e=Number(t);return isNaN(e)?d:e},getDirection=function(t){return/^(NW|NE|SW|SE)$/i.test(t)?t.toUpperCase():h},v={NW:function(t){return[0,cache.ppbHeight*t]},NE:function(t){return[cache.dispWidth-cache.ppbWidth-l,cache.ppbHeight*t]},SW:function(t){return[0,cache.ppbHeight*(4-t)]},SE:function(t){return[cache.dispWidth-cache.ppbWidth-l,cache.ppbHeight*(4-t)]}},stackPPb=function(t,e,n,i){var r=f[e],a=v[n](r),c="-breakjob -noppb -noactive -nostartmsg -wait:no",o="-bootid:"+e+" -q",u="*windowsize %N,"+cache.ppbWidth+","+cache.ppbHeight,p="*execute "+t+',*js ":'+s+',ppx_Activate",'+e,P="*linemessage %("+i+"%)",x="*execute "+t+',*js ":'+s+',ppx_Success",'+e;PPx.Execute("*setcust _WinPos:B"+e+"="+a.join(",")+","+cache.ppbWidth+","+cache.ppbHeight+",0"),PPx.Execute("*maxlength 3000%:%OP *run "+c+" %0ppbw.exe "+o+" -k %("+u+"%:"+p+"%:"+P+"%:"+i+"%:"+x+"%)")};PPx.result="DONE:"+x,main();
