var t,e,n,i;Object.keys||(Object.keys=(t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),i=(n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(r){if("function"!=typeof r&&("object"!=typeof r||null==r))throw new Error("Object.keys: called on non-object");var a,c,u=[];for(a in r)t.call(r,a)&&u.push(a);if(e)for(c=0;c<i;c++)t.call(r,n[c])&&u.push(n[c]);return u}));var validArgs=function(){for(var t=[],e=PPx.Arguments;!e.atEnd();e.moveNext())t.push(e.value);return t},r={storeData:8e4,veHandler:80001,setsel:80002,stackPPb:80003},isEmptyStr=function(t){return""===t},isZero=function(t){return null!=t&&("0"===t||0===t)},a="S_ppm#event",c={set:function(t,e){PPx.Execute("*setcust "+a+":"+t+"=%("+e+"%)")},unset:function(t){var e=PPx.Extract("%*getcust("+a+":"+t+")");!isEmptyStr(e)&&PPx.Execute("*deletecust "+a+":"+t)},"do":function(t){var e=PPx.Extract("%*getcust("+a+":"+t+")");!isEmptyStr(e)&&PPx.Execute(e)},once:function(t){var e=PPx.Extract("%*getcust("+a+":"+t+")");isEmptyStr(e)||(PPx.Execute(e),PPx.Execute("*deletecust "+a+":"+t))}},pathSelf=function(){var t,e,n=PPx.ScriptName;return~n.indexOf("\\")?(t=extractFileName(n),e=PPx.Extract("%*name(DKN,"+n+")")):(t=n,e=PPx.Extract("%FDN")),{scriptName:t,parentDir:e.replace(/\\$/,"")}},extractFileName=function(t,e){return void 0===e&&(e="\\"),"\\"!==e&&"/"!==e&&(e="\\"),t.slice(t.lastIndexOf(e)+1)};Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){var n;if(null==this)throw new Error('Array.indexOf: "this" is null or not defined');var i=Object(this),r=i.length>>>0;if(0===r)return-1;var a=null!=e?e:0;if(Math.abs(a)===Infinity&&(a=0),a>=r)return-1;for(n=Math.max(a>=0?a:r-Math.abs(a),0);n<r;){if(n in i&&i[n]===t)return n;n++}return-1});var u,p=["KC_main","KV_main","KV_img","KV_crt","KV_page","KB_edit","K_ppe","K_edit"],_validTable=function(t){return~p.indexOf(t)?t:"KC_main"},_discard=function(t){return function(e){var n=e.table,i=e.label,r=e.mapkey,a=e.cond,c=void 0===a?"instantly":a,u=e.debug,p=void 0===u?"0":u,o=PPx.StayMode,s=PPx.Extract("%n"),P=PPx.Extract("%FDV"),x="*linecust "+i+s+","+_validTable(n)+":"+t+",",d={instantly:"",once:'*if("'+s+'"=="%n")%:',hold:'*if("'+s+'"=="%n")&&("'+P+'"!="%FDV")%:'}[c],f=[x];r&&(PPx.Execute("*mapkey use,"+r),f.push("*mapkey delete,"+r)),f.push('*js ":'+o+',ppx_Discard",'+p+","+i),PPx.Execute(x+"%(*if %*stayinfo("+o+")%:"+d+f.join("%:")+"%)"),PPx.Execute('*run -nostartmsg %0pptrayw.exe -c %%K"@LOADCUST"')}},getStaymodeId=function(t){var e=Number(PPx.Extract("%*getcust(S_ppm#staymode:"+t+")"));return!Number.isNaN(e)&&e>1e4&&e},ppx_Discard$1=function(t,e){var n;PPx.StayMode=0,e=null!=(n=e)?n:"","DEBUG"===t&&PPx.linemessage("[DEBUG] discard "+e)},o=(_discard("ACTIVEEVENT"),_discard("LOADEVENT"),function(t,e,n,i,r){var a="*linecust "+n+","+_validTable(t),c=a+":"+e+",",u={instantly:"",once:'*if("%n"=="%%n")',hold:'*if("%n"=="%%n")&&("%FDV"=="%%FDV")'}[r];PPx.Execute(a+":"+e+","+u+"%%:"+c+"%%:"+i),PPx.Execute('%K"@LOADCUST"')}),s=getStaymodeId("stachPPb")||r.stackPPb,P="ppm_stackppb",x="DoneStackPPb",d={J:0,K:1,L:2,M:3,N:4},f=400,l=10,E=10,b=50,h="SE",N={STANDBY:"READY",INITIAL:"STARTING",ACTIVE:"ACTIVATE",BREAK:"BREAKING"},g={dispWidth:Number(PPx.Extract("%*getcust(S_ppm#global:disp_width)")),dispHeight:Number(PPx.Extract("%*getcust(S_ppm#global:disp_height)"))-b,ppbWidth:f,ppbHeight:0,ppbState:{J:N.STANDBY,K:N.STANDBY,L:N.STANDBY,M:N.STANDBY,N:N.STANDBY},enableIds:Object.keys(d),instances:0,ppcid:PPx.Extract("%n")};if(isZero(g.dispWidth)||isZero(g.dispHeight)){var v=pathSelf().scriptName;PPx.Echo("[ERROR] "+v+" S_ppm#global:disp_width & disp_height needs to be set."),PPx.Quit(-1)}var main=function(){var t=validArgs(),e=t[0],n=t[1],i=t[2];g.ppbWidth=setPPbWidth(e),g.ppbHeight=Math.floor(g.dispHeight/5),g.direction=getDirection(n),PPx.StayMode=s,PPx.Execute("*linecust "+P+",KC_main:LOADEVENT,*execute "+g.ppcid+',*js ":'+s+',ppx_Discard"'),PPx.Execute('%K"@LOADCUST"'),ppx_resume(e,n,i)},ppx_resume=function(t,e,n){if(PPx.Execute("*wait 0,2"),g.instances++,null!=t){if(!(g.instances>=E))for(;;){for(var i=0,r=g.enableIds;i<r.length;i++){var a=r[i],c=isEmptyStr(PPx.Extract("%NB"+a)),p=g.ppbState[a];if(c&&p!==N.INITIAL)return g.ppbState[a]=N.INITIAL,void stackPPb(g.ppcid,a,g.direction,n)}var o=1e3+Math.floor(100*Math.random());if(PPx.Execute("*wait "+o+",2"),u===N.BREAK){g.instances--;break}}}else u=N.BREAK},ppx_Activate=function(t){g.ppbState[t]=N.ACTIVE},ppx_Success=function(t){g.ppbState[t]=N.STANDBY,g.instances--,PPx.Execute("*closeppx B"+t),ppx_Discard()},ppx_Discard=function(){if(g.instances>=0)for(var t=PPx.Extract("%*ppxlist(-B)"),e=0,n=g.enableIds;e<n.length;e++){var i=n[e];if(~t.indexOf("B_"+i))return}for(var r=0,a=g.enableIds;r<a.length;r++){var u=a[r];PPx.Execute("*deletecust _WinPos:B"+u)}c.once(x),PPx.Execute("*linecust "+P+",KC_main:LOADEVENT,"),PPx.StayMode=0},setPPbWidth=function(t){var e=Number(t);return Number.isNaN(e)?f:e},getDirection=function(t){return/^(NW|NE|SW|SE)$/i.test(t)?t.toUpperCase():h},S={NW:function(t){return[0,g.ppbHeight*t]},NE:function(t){return[g.dispWidth-g.ppbWidth-l,g.ppbHeight*t]},SW:function(t){return[0,g.ppbHeight*(4-t)]},SE:function(t){return[g.dispWidth-g.ppbWidth-l,g.ppbHeight*(4-t)]}},stackPPb=function(t,e,n,i){var r=d[e],a=S[n](r),c="-breakjob -noppb -noactive -nostartmsg -wait:no",u="-bootid:"+e+" -q",p="*windowsize %N,"+g.ppbWidth+","+g.ppbHeight,o="*execute "+t+',*js ":'+s+',ppx_Activate",'+e,P='echo "%('+i+'%)"',x="*execute "+t+',*js ":'+s+',ppx_Success",'+e;PPx.Execute("*setcust _WinPos:B"+e+"="+a.join(",")+","+g.ppbWidth+","+g.ppbHeight+",0"),PPx.Execute("*maxlength 3000%:%OP *run "+c+" %0ppbw.exe "+u+" -k %("+p+"%:"+o+"%:"+P+"%:"+i+"%:"+x+"%)")};PPx.result="DONE:"+x,main();
